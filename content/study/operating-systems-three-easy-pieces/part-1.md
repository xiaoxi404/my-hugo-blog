---
title: "Part 1"
date: 2022-04-10T19:38:25+08:00
draft: false
slug: virtualization
---

# 第四章 抽象：进程

时分共享CPU技术：操作系统通过让一个进程只运行一个时间片，然后切换到其他进程，提供了存在多个虚拟CPU的假象。

空分共享：资源在空间上被划分给希望使用它的人。例如，磁盘空间自然是一个空分共享资源，因为一旦将块分配给文件，在用户删除文件之前，不可能将它分配给其他文件。

## 4.1 抽象进程

进程：操作系统为正在运行的程序提供的抽象

## 4.2 进程API

- 创建（create）：操作系统必须包含一些创建进程的方法。在shell中键入命令或双击应用程序图标时，会调用操作系统来创建新进程，运行指定的程序。
- 销毁（destroy）：由于存在创建进程的接口，因此系统还提供了一个强制销毁进程的接口。
- 等待（wait）：有时提供进程停止运行是有用的，因此经常提供某种等待接口。
- 其他控制（miscellaneous control）：除了杀死或等待进程外，有时还可能有其他控制。例如，大多数操作系统提供某种方法来暂停进程（停止运行一段时间），然后恢复（继续运行）。
- 状态（status）：通常也有一些接口可以获得有关进程的状态信息，例如运行了多长时间，或者处于什么状态。

## 4.3 进程创建：更多细节

操作系统第一步将代码和所有静态数据（例如初始化变量）加载（load）到内存中，加载到进程的地址空间。 现代操作系统惰性（lazily）执行该过程，即仅在程序执行期间需要加载的代码或数据片段，才会加载。

操作系统还需要执行一些其他操作。必须为程序的运行时站（run-time stack 或 stack）分配一些内存。C程序使用栈存放局部变量、函数参数和返回地址。操作系统分配这些内存，并提供给进程。

操作系统也可能为程序的堆（heap）分配一些内存。在 C 程序中，堆用于显式请求的动态分配数据。程序通过调用 malloc()来请求这样的空间，并通过调用 free()来明确地释放它。

操作系统还将执行一些其他初始化任务，特别是输入/输出（I/O）相关的任务。例如，在 UNIX 系统中，默认情况下每个进程都有 3 个打开的文件描述符（file descriptor），用于标准输入、输出和错误。这些描述符让程序轻松读取来自终端的输入以及打印输出到屏幕。

## 4.4 进程状态

- 运行（running）：在运行状态下，进程正在处理器上运行。这意味着它正在执行指令。
- 就绪（ready）：在就绪状态下，进程已准备好运行，但由于某种原因，操作系统选择不在此时运行。
- 堵塞（blocked）：在堵塞状态下，一个进程执行了某种操作，直到发生其他事件时才会准备运行。一个常见例子：当进程向磁盘发起I/O请求时，它会被阻塞，因此其他进程可以使用处理器。

![进程：状态切换](https://img.nobody404.xyz/img/%E8%BF%9B%E7%A8%8B%E8%BD%AC%E6%8D%A2.webp)

## 4.5 数据结构

操作系统有一些关键的数据结构来跟踪各种相关的信息。例如，为了跟踪每个进程的状态，操作系统可能会为所有就绪的进程保留某种进程列表（process list），以及跟踪当前正在运行的进程的一些附加信息。操作系统还必须以某种方式跟踪被阻塞的进程。当 I/O 事件完成时，操作系统应确保唤醒正确的进程，让它准备好再次运行。

进程还有初始（initial）和最终（final）两种状态，前者代表进程在创建时处于的状态，后者代表程序处于已退出但尚未清理的最终状态（final）状态。

## 4.6 小结

我们已经了解了操作系统的最基本抽象：进程。他很简单地被视为一个正在进行的程序。